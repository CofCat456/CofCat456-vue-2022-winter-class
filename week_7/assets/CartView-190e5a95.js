import{L as D}from"./Loading-42f177d0.js";import{D as k}from"./DeleteModal-f19c3827.js";import{_ as A,j as r,l as u,r as f,o as h,c as p,e as t,f as c,t as d,F as M,g as L,b as C,m as v,v as y,d as _,w as g,n as N}from"./index-b8bbc98a.js";import{e as V,u as $,r as T,f as P,h as B}from"./api-161edbe7.js";const j={components:{Loading:D,DeleteModal:k},data(){return{tempProduct:{},carts:[],total:0,final_total:0,code:""}},computed:{cartsExist(){return this.carts&&this.carts.length===0}},methods:{openModal(s,e){if(s==="delete"){const{id:l,product:i}=e;this.tempProduct={...i,cart_id:l},this.$refs.productDeleteModal.show()}else s==="deleteAll"&&(this.tempProduct={title:"全部購物車"},this.$refs.productDeleteModal.show())},getCarts(){this.$refs.loading.show(),V().then(s=>{this.$refs.loading.hide();const{data:{success:e,data:{carts:l,total:i,final_total:o}}}=s;e&&(this.carts=l,this.total=i,this.final_total=o)}).catch(s=>{this.$refs.loading.hide();const{response:e}=s;r(e)})},updateCart(s){this.$refs.loading.show();const{id:e,qty:l}=s;$(e,{data:{product_id:e,qty:l}}).then(i=>{this.$refs.loading.hide();const{data:{success:o,message:a}}=i;u(o,a),this.getCarts()}).catch(i=>{this.$refs.loading.hide();const{response:o}=i;r(o)})},removeCartItem(s){this.$refs.loading.show(),T(s).then(e=>{this.$refs.loading.hide();const{data:{success:l,message:i}}=e;u(l,i),this.getCarts()}).catch(e=>{this.$refs.loading.hide();const{response:l}=e;r(l)})},removeAllCart(){this.$refs.loading.show(),P().then(s=>{this.$refs.loading.hide();const{data:{success:e,message:l}}=s;u(e,l),this.getCarts()}).catch(s=>{this.$refs.loading.hide();const{response:e}=s;r(e)})},useCoupon(){this.$refs.loading.show();const s={data:{code:this.code}};console.log(this.code),B(s).then(e=>{this.$refs.loading.hide();const{data:{success:l,message:i}}=e;u(l,i),this.getCarts()}).catch(e=>{this.$refs.loading.hide();const{response:l}=e;r(l)})}},mounted(){this.getCarts()}},U={class:"container"},q={class:"row justify-content-center py-5"},E={class:"col"},F=t("h2",{class:"text-center fw-bold"},"購物車",-1),I={class:"fw-bold mx-1"},R={class:"table align-middle mt-4 table-hover"},z=t("thead",null,[t("tr",{class:"text-center"},[t("th",{width:"200"},"商品圖片"),t("th",{width:"250"},"商品名稱"),t("th",null,"單位"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"售價"),t("th",null,"小計"),t("th",null,"刪除")])],-1),S={class:"ratio ratio-16x9"},G=["src","alt"],H={class:"input-group input-group-sm"},J={class:"input-group"},K=["onUpdate:modelValue","onBlur"],O={class:"input-group-text",id:"basic-addon2"},Q=["onClick"],W=t("i",{class:"bi bi-trash3"},null,-1),X=[W],Y=t("td",{colspan:"6",class:"text-end"},"總計",-1),Z={class:"text-end"},tt={key:0},et=t("td",{colspan:"6",class:"text-end text-success"},"折扣價",-1),st={class:"text-end text-success"},ot={class:"input-group my-2"},nt={class:"d-grid gap-2 mt-4 d-md-flex justify-content-md-between"},lt=["disabled"];function it(s,e,l,i,o,a){const b=f("RouterLink"),x=f("Loading"),w=f("DeleteModal");return h(),p("div",U,[t("div",q,[t("div",E,[F,t("p",null,[c(" 總共有"),t("span",I,d(o.carts.length),1),c("件商品 ")]),t("table",R,[z,t("tbody",null,[o.carts?(h(!0),p(M,{key:0},L(o.carts,n=>(h(),p("tr",{key:n.id,class:"text-center"},[t("td",null,[t("div",S,[t("img",{src:n.product.imageUrl,class:"img-fluid object-fit-cover rounded",alt:n.product.title},null,8,G)])]),t("td",null,d(n.product.title),1),t("td",null,"1 / "+d(n.product.unit),1),t("td",null,[t("div",H,[t("div",J,[v(t("input",{"onUpdate:modelValue":m=>n.qty=m,onBlur:m=>a.updateCart(n),min:"1",type:"number",class:"form-control"},null,40,K),[[y,n.qty,void 0,{number:!0}]]),t("span",O,d(n.product.unit),1)])])]),t("td",null,d(s.$filters.currency(n.total,"NT ")),1),t("td",null,d(s.$filters.currency(n.final_total,"NT ")),1),t("td",null,[t("button",{type:"button",class:"btn",onClick:m=>a.openModal("delete",n)},X,8,Q)])]))),128)):C("",!0)]),t("tfoot",null,[t("tr",null,[Y,t("td",Z,d(s.$filters.currency(o.total,"NT ")),1)]),o.final_total!==o.total?(h(),p("tr",tt,[et,t("td",st,d(s.$filters.currency(o.final_total,"NT ")),1)])):C("",!0)])]),t("div",ot,[v(t("input",{style:{"max-width":"250px"},type:"text",class:"form-control ms-auto",placeholder:"請輸入優惠代碼","aria-label":"請輸入優惠代碼","aria-describedby":"button-addon","onUpdate:modelValue":e[0]||(e[0]=n=>o.code=n)},null,512),[[y,o.code]]),t("button",{class:"btn btn-outline-success",type:"button",id:"button-addon",onClick:e[1]||(e[1]=(...n)=>a.useCoupon&&a.useCoupon(...n))}," 套用優惠卷 ")]),t("div",nt,[_(b,{class:"btn btn-outline-info",to:{name:"ProductList"}},{default:g(()=>[c(" 繼續購物 ")]),_:1}),t("button",{class:"btn btn-outline-danger",disabled:a.cartsExist,onClick:e[2]||(e[2]=n=>a.openModal("deleteAll"))}," 清空購物車 ",8,lt),_(b,{class:N(["btn btn-outline-success",{disabled:o.carts.length===0}]),to:{name:"Checkout"}},{default:g(()=>[c("送出訂單")]),_:1},8,["class"])])])]),_(x,{ref:"loading"},null,512),_(w,{ref:"productDeleteModal",id:o.tempProduct.cart_id,title:o.tempProduct.title,onDelete:a.removeCartItem,onDeleteAll:a.removeAllCart},{default:g(()=>[c(" 購物車 ")]),_:1},8,["id","title","onDelete","onDeleteAll"])])}const ut=A(j,[["render",it]]);export{ut as default};
