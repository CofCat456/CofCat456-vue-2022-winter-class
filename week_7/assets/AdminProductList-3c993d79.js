import{L as D}from"./Loading-7a76afc0.js";import{P as F}from"./PaginationBasic-72631d5b.js";import{m as $,D as L}from"./DeleteModal-ab9e1090.js";import{m as B,n as T,o as E,p as U,q as j}from"./api-fb50adcd.js";import{_ as x,l as f,j as h,o as r,c as a,e,m as u,v as m,f as k,b as y,F as M,g as C,T as V,t as _,i as I,r as P,d as v,U as H,w as S,n as w}from"./index-f9a2aef5.js";const O={props:{isNew:{type:Boolean,default:!1},product:{type:Object,default:()=>{}}},data(){return{status:{},modal:"",tempProduct:{}}},mixins:[$],watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imageUrl||(this.tempProduct.imageUrl="")}},methods:{uploadFile(){const i=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",i),this.status.fileUploading=!0,B(t).then(o=>{this.status.fileUploading=!1;const{data:{success:d,imageUrl:s,message:n}}=o;d?(this.tempProduct.imageUrl=s,this.$refs.fileInput.value=""):this.$refs.fileInput.value="",f(d,n)}).catch(o=>{const{response:d}=o;this.status.fileUploading=!1,h(d)})},sureHandler(){const i=this.isNew?"add":"update";this.$emit(`${i}-product`,{data:this.tempProduct})}}},q={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},z={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={class:"modal-title",id:"exampleModalLabel"},Q={key:0},R={key:1},W=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-4"},ee={class:"mb-3"},te=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),se={class:"mb-3"},oe={for:"customFile",class:"form-label"},le={key:0,class:"spinner-border spinner-border-sm",role:"status"},ie=e("span",{class:"visually-hidden"},"Loading...",-1),de=[ie],ne=["src"],ce={key:0,class:"mt-5"},re=["onUpdate:modelValue"],ae={class:"my-2"},ue=["src"],me=["onClick"],pe={key:0},he={class:"col-sm-8"},_e={class:"mb-3"},fe=e("label",{for:"title",class:"form-label"},"標題",-1),ge={class:"row gx-2"},be={class:"mb-3 col-md-6"},Pe=e("label",{for:"category",class:"form-label"},"分類",-1),ve={class:"mb-3 col-md-6"},ye=e("label",{for:"price",class:"form-label"},"單位",-1),Ue={class:"row gx-2"},we={class:"mb-3 col-md-6"},xe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),ke={class:"mb-3 col-md-6"},Me=e("label",{for:"price",class:"form-label"},"售價",-1),Ce=e("hr",null,null,-1),Ve={class:"mb-3"},Ne=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ae={class:"mb-3"},De=e("label",{for:"content",class:"form-label"},"說明內容",-1),Fe={class:"mb-3"},$e={class:"form-check"},Le=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Be={class:"modal-footer"},Te=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ee(i,t,o,d,s,n){return r(),a("div",q,[e("div",z,[e("div",G,[e("div",J,[e("h5",K,[o.isNew?(r(),a("span",Q,"新增產品")):(r(),a("span",R,"編輯產品"))]),W]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[te,u(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[0]||(t[0]=l=>s.tempProduct.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[m,s.tempProduct.imageUrl]])]),e("div",se,[e("label",oe,[k("或 上傳圖片 "),s.status.fileUploading?(r(),a("div",le,de)):y("",!0)]),e("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:t[1]||(t[1]=(...l)=>n.uploadFile&&n.uploadFile(...l))},null,544)]),e("img",{class:"img-fluid rounded",src:s.tempProduct.imageUrl},null,8,ne),s.tempProduct.imagesUrl?(r(),a("div",ce,[(r(!0),a(M,null,C(s.tempProduct.imagesUrl,(l,p)=>(r(),a("div",{class:"mb-3",key:p},[u(e("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":g=>s.tempProduct.imagesUrl[p]=g,placeholder:"請輸入連結"},null,8,re),[[m,s.tempProduct.imagesUrl[p]]]),e("div",ae,[e("img",{class:"img-fluid rounded",src:l},null,8,ue)]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:g=>s.tempProduct.imagesUrl.splice(p,1)}," 移除 ",8,me)]))),128)),s.tempProduct.imagesUrl[s.tempProduct.imagesUrl.length-1]||!s.tempProduct.imagesUrl.length?(r(),a("div",pe,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=l=>s.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):y("",!0)])):y("",!0)]),e("div",he,[e("div",_e,[fe,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[3]||(t[3]=l=>s.tempProduct.title=l),placeholder:"請輸入標題"},null,512),[[m,s.tempProduct.title]])]),e("div",ge,[e("div",be,[Pe,u(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":t[4]||(t[4]=l=>s.tempProduct.category=l),placeholder:"請輸入分類"},null,512),[[m,s.tempProduct.category]])]),e("div",ve,[ye,u(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":t[5]||(t[5]=l=>s.tempProduct.unit=l),placeholder:"請輸入單位"},null,512),[[m,s.tempProduct.unit]])])]),e("div",Ue,[e("div",we,[xe,u(e("input",{type:"number",class:"form-control",id:"origin_price",min:"0","onUpdate:modelValue":t[6]||(t[6]=l=>s.tempProduct.origin_price=l),placeholder:"請輸入原價"},null,512),[[m,s.tempProduct.origin_price,void 0,{number:!0}]])]),e("div",ke,[Me,u(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[7]||(t[7]=l=>s.tempProduct.price=l),min:"0",placeholder:"請輸入售價"},null,512),[[m,s.tempProduct.price,void 0,{number:!0}]])])]),Ce,e("div",Ve,[Ne,u(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":t[8]||(t[8]=l=>s.tempProduct.description=l),placeholder:"請輸入產品描述"},null,512),[[m,s.tempProduct.description]])]),e("div",Ae,[De,u(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":t[9]||(t[9]=l=>s.tempProduct.content=l),placeholder:"請輸入產品說明內容"},null,512),[[m,s.tempProduct.content]])]),e("div",Fe,[e("div",$e,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=l=>s.tempProduct.is_enabled=l),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[V,s.tempProduct.is_enabled]]),Le])])])])]),e("div",Be,[Te,e("button",{type:"button",class:"btn btn-primary",onClick:t[11]||(t[11]=(...l)=>n.sureHandler&&n.sureHandler(...l))},_(o.isNew?"新增產品":"更新產品"),1)])])])],512)}const je=x(O,[["render",Ee]]),Ie={components:{Loading:D,Pagination:F,ProductModal:je,DeleteModal:L},data(){return{isNew:!1,products:[],tempProduct:{},pagination:{}}},methods:{getBadgeColor(i){return`text-bg-${I.get(i)||"secondary"}`},openModal(i,t){i==="new"?(this.isNew=!0,this.tempProduct={},this.$refs.productModal.show()):i==="edit"?(this.isNew=!1,this.tempProduct={...t},this.$refs.productModal.show()):i==="delete"&&(this.tempProduct={...t},this.$refs.productDeleteModal.show())},getProduct(i=1){T(i).then(t=>{this.$refs.loading.hide();const{data:{success:o,products:d,pagination:s}}=t;if(d===null){this.products=[];return}o&&(this.products=Object.values(d),this.pagination=s)}).catch(t=>{this.$refs.loading.hide();const{response:o}=t;h(o)})},addProduct(i){this.$refs.loading.show(),E(i).then(t=>{this.$refs.loading.hide(),this.$refs.productModal.hide();const{data:{success:o,message:d=" "}}=t;f(o,d),this.getProduct()}).catch(t=>{this.$refs.loading.hide();const{response:o}=t;h(o)})},updateEnabled(i){this.$refs.loading.show();const{id:t}=i;U(t,{data:i}).then(o=>{this.$refs.loading.hide();const{data:{success:d,message:s=" "}}=o;f(d,s),this.getProduct()}).catch(o=>{this.$refs.loading.hide();const{response:d}=o;h(d)})},updateProduct(i){this.$refs.loading.show();const{data:{id:t}}=i;U(t,i).then(o=>{this.$refs.loading.hide(),this.$refs.productModal.hide();const{data:{success:d,message:s=" "}}=o;f(d,s),this.getProduct()}).catch(o=>{this.$refs.loading.hide();const{response:d}=o;h(d)})},delProduct(i){this.$refs.loading.show(),j(i).then(t=>{this.$refs.loading.hide();const{data:{success:o,message:d}}=t;f(o,d),this.getProduct()}).catch(t=>{this.$refs.loading.hide();const{response:o}=t;h(o)})}},mounted(){this.getProduct()}},He={class:"container"},Se={class:"row justify-content-center py-5"},Oe={class:"col"},qe=e("h2",null,"產品列表",-1),ze={class:"text-end mt-4"},Ge={class:"table table-hover mt-4 align-middle"},Je=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),Ke={class:"form-check form-switch"},Qe=["id","onUpdate:modelValue","onChange"],Re=["for"],We={key:0},Xe={key:1},Ye={class:"btn-group"},Ze=["onClick"],et=["onClick"];function tt(i,t,o,d,s,n){const l=P("Pagination"),p=P("ProductModal"),g=P("DeleteModal"),N=P("Loading");return r(),a("div",He,[e("div",Se,[e("div",Oe,[qe,e("div",ze,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=c=>n.openModal("new"))},"建立新的產品")]),e("table",Ge,[Je,e("tbody",null,[(r(!0),a(M,null,C(s.products,(c,A)=>(r(),a("tr",{key:c.id,class:w({"text-secondary":!c.is_enabled})},[e("td",null,_(A+1),1),e("td",null,_(c.title),1),e("td",null,[e("span",{class:w(["badge rounded-pill px-2",n.getBadgeColor(c.category)])},_(c.category),3)]),e("td",null,_(i.$filters.currency(c.origin_price,"NT ")),1),e("td",null,_(i.$filters.currency(c.price,"NT ")),1),e("td",null,[e("div",Ke,[u(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${c.id}`,"true-value":1,"false-value":0,"onUpdate:modelValue":b=>c.is_enabled=b,onChange:b=>n.updateEnabled(c)},null,40,Qe),[[V,c.is_enabled]]),e("label",{class:"form-check-label",for:`paidSwitch${c.id}`},[c.is_enabled?(r(),a("span",We,"已啟用")):(r(),a("span",Xe,"未啟用"))],8,Re)])]),e("td",null,[e("div",Ye,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:b=>n.openModal("edit",c)}," 編輯 ",8,Ze),e("button",{class:"btn btn-outline-danger btn-sm",onClick:b=>n.openModal("delete",c)}," 刪除 ",8,et)])])],2))),128))])]),v(l,H(s.pagination,{onEmitPages:n.getProduct}),null,16,["onEmitPages"])])]),v(p,{ref:"productModal",isNew:s.isNew,product:s.tempProduct,onAddProduct:n.addProduct,onUpdateProduct:n.updateProduct},null,8,["isNew","product","onAddProduct","onUpdateProduct"]),v(g,{ref:"productDeleteModal",id:s.tempProduct.id,title:s.tempProduct.title,onDelete:n.delProduct},{default:S(()=>[k("產品")]),_:1},8,["id","title","onDelete"]),v(N,{ref:"loading"},null,512)])}const nt=x(Ie,[["render",tt]]);export{nt as default};
