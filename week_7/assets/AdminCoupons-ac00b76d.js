import{L as k}from"./Loading-42f177d0.js";import{P as x}from"./PaginationBasic-6b062e7b.js";import{m as $,D as A}from"./DeleteModal-f19c3827.js";import{_ as g,o as a,c,e,m as u,v as h,T as D,t as r,j as m,l as b,r as _,F as N,g as U,d as f,U as V,w as L,f as P}from"./index-b8bbc98a.js";import{x as T,y as j,z as B,A as E}from"./api-161edbe7.js";const H={props:{isNew:{type:Boolean,default:!1},coupon:{type:Object,default(){return{}}}},data(){return{tempCoupon:{},due_date:""}},mixins:[$],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{sureHandler(){const s=this.isNew?"add":"update";this.$emit(`${s}-coupon`,{data:{is_enabled:0,...this.tempCoupon}})}}},O={id:"couponModal",ref:"modal",class:"modal fade",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},S={class:"modal-dialog modal-dialog-centered"},F={class:"modal-content border-0"},z={class:"modal-header bg-dark text-white"},I={class:"modal-title",id:"exampleModalLabel"},q={key:0},G={key:1},J=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Q={class:"mb-3"},R=e("label",{for:"title",class:"form-label"},"標題",-1),W={class:"mb-3"},X=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),Y={class:"mb-3"},Z=e("label",{for:"due_date",class:"form-label"},"到期日",-1),ee={class:"mb-3"},oe=e("label",{for:"price",class:"form-label"},"折扣百分比",-1),te={class:"mb-3"},se={class:"form-check"},ne=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),le={class:"modal-footer"},de=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function ie(s,o,n,d,t,i){return a(),c("div",O,[e("div",S,[e("div",F,[e("div",z,[e("h5",I,[n.isNew?(a(),c("span",q,"新增優惠卷")):(a(),c("span",G,"編輯優惠卷"))]),J]),e("div",K,[e("div",Q,[R,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=l=>t.tempCoupon.title=l),placeholder:"請輸入標題"},null,512),[[h,t.tempCoupon.title]])]),e("div",W,[X,u(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=l=>t.tempCoupon.code=l),placeholder:"請輸入優惠碼"},null,512),[[h,t.tempCoupon.code]])]),e("div",Y,[Z,u(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=l=>t.due_date=l)},null,512),[[h,t.due_date]])]),e("div",ee,[oe,u(e("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":o[3]||(o[3]=l=>t.tempCoupon.percent=l),placeholder:"請輸入折扣百分比"},null,512),[[h,t.tempCoupon.percent,void 0,{number:!0}]])]),e("div",te,[e("div",se,[u(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=l=>t.tempCoupon.is_enabled=l),id:"is_enabled"},null,512),[[D,t.tempCoupon.is_enabled]]),ne])])]),e("div",le,[de,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=(...l)=>i.sureHandler&&i.sureHandler(...l))},r(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ae=g(H,[["render",ie]]),ce={components:{Loading:k,Pagination:x,CouponModal:ae,DeleteModal:A},props:{config:Object},data(){return{coupons:[],pagination:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1}},methods:{openModal(s,o){s==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.show()):s==="edit"?(this.isNew=!1,this.tempCoupon={...o},this.$refs.couponModal.show()):s==="delete"&&(this.tempCoupon={...o},this.$refs.couponDeleteModal.show())},getCoupons(s=1){this.$refs.loading.show(),T(s).then(o=>{this.$refs.loading.hide();const{data:{success:n,coupons:d,pagination:t}}=o;n&&(this.coupons=d,this.pagination=t)}).catch(o=>{this.$refs.loading.hide();const{response:n}=o;m(n)})},addCoupon(s){this.$refs.loading.show(),j(s).then(o=>{this.$refs.loading.hide(),this.$refs.couponModal.hide();const{data:{success:n,message:d=" "}}=o;b(n,d),this.getCoupons()}).catch(o=>{this.$refs.loading.hide();const{response:n}=o;m(n)})},updateCoupon(s){this.$refs.loading.show();const{id:o}=s;B(o,s).then(n=>{this.$refs.loading.hide(),this.$refs.couponModal.hide();const{data:{success:d,message:t=" "}}=n;b(d,t),this.getCoupons()}).catch(n=>{this.$refs.loading.hide();const{response:d}=n;m(d)})},delCoupon(s){this.$refs.loading.show(),E(s).then(o=>{this.$refs.loading.hide();const{data:{success:n,message:d}}=o;b(n,d),this.getCoupons()}).catch(o=>{this.$refs.loading.hide();const{response:n}=o;m(n)})}},mounted(){this.getCoupons()}},pe={class:"container"},ue={class:"row jsutify-content-center py-5"},re={class:"col"},he={class:"text-end mt-4"},me={class:"table mt-4"},_e=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"折扣百分比"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),fe={key:0,class:"text-success"},be={key:1,class:"text-muted"},Ce={class:"btn-group"},ge=["onClick"],we=["onClick"];function ve(s,o,n,d,t,i){const l=_("Pagination"),w=_("CouponModal"),v=_("DeleteModal"),y=_("Loading");return a(),c("div",pe,[e("div",ue,[e("div",re,[e("div",he,[e("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=p=>i.openModal("new"))}," 建立新的優惠券 ")]),e("table",me,[_e,e("tbody",null,[(a(!0),c(N,null,U(t.coupons,(p,C)=>(a(),c("tr",{key:C},[e("td",null,r(C+1),1),e("td",null,r(p.title),1),e("td",null,r(p.percent)+"%",1),e("td",null,r(s.$filters.date(p.due_date)),1),e("td",null,[p.is_enabled===1?(a(),c("span",fe,"啟用")):(a(),c("span",be,"未啟用"))]),e("td",null,[e("div",Ce,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:M=>i.openModal("edit",p)}," 編輯 ",8,ge),e("button",{class:"btn btn-outline-danger btn-sm",onClick:M=>i.openModal("delete",p)}," 刪除 ",8,we)])])]))),128))])]),f(l,V(t.pagination,{onEmitPages:i.getCoupons}),null,16,["onEmitPages"])])]),f(w,{ref:"couponModal",isNew:t.isNew,coupon:t.tempCoupon,onAddCoupon:i.addCoupon,onUpdateCoupon:i.updateCoupon},null,8,["isNew","coupon","onAddCoupon","onUpdateCoupon"]),f(v,{ref:"couponDeleteModal",id:t.tempCoupon.id,title:t.tempCoupon.title,onDelete:i.delCoupon},{default:L(()=>[P("優惠卷")]),_:1},8,["id","title","onDelete"]),f(y,{ref:"loading"},null,512)])}const Ae=g(ce,[["render",ve]]);export{Ae as default};
