import{L as v}from"./Loading-e3b11655.js";import{P as w}from"./ProductDeleteModal-47ed5f3e.js";import{S as d}from"./sweetalert2.all-4bf24128.js";import{c as P}from"./global-69792a57.js";import{c as B,u as y,r as D,d as k}from"./api-448cdce1.js";import{_ as A,r as _,o as c,c as u,b as t,d as h,t as a,F as M,e as L,f as g,a as m,w as C,h as V,v as N}from"./index-c877c6bc.js";const j={components:{Loading:v,ProductDeleteModal:w},data(){return{tempProduct:{},carts:[],total:0,final_total:0}},computed:{cartsExist(){return this.carts&&this.carts.length===0}},methods:{openModal(e,s){if(e==="delete"){const{id:l,product:n}=s;this.tempProduct={...n,cart_id:l},this.$refs.productDeleteModal.show()}else e==="deleteAll"&&(this.tempProduct={title:"全部購物車"},this.$refs.productDeleteModal.show())},getPrice(e){return P(e,"$ ")},getCarts(){B().then(e=>{const{data:{data:{carts:s,total:l,final_total:n}}}=e;this.carts=s,this.total=l,this.final_total=n,this.$refs.loading.hide()}).catch(e=>{console.log(e),this.$refs.loading.hide()})},updateCart(e){this.$refs.loading.show();const{id:s,qty:l}=e;y(s,{data:{product_id:s,qty:l}}).then(n=>{const{data:{message:o=" "}}=n;this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"success",title:o}),this.getCarts()}).catch(n=>{console.log(n);const{response:{data:{message:o}}}=n;this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"error",title:"更新失敗",text:o})})},removeCartItem(e){this.$refs.loading.show(),D(e).then(()=>{this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"success",title:"移除成功(･8･)！"}),this.getCarts()}).catch(s=>{const{response:{data:{message:l}}}=s;this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"error",title:"移除失敗",text:l})})},removeAllCart(){this.$refs.loading.show(),k().then(()=>{this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"success",title:"移除成功(′゜ω。‵)！"}),this.getCarts()}).catch(e=>{const{response:{data:{message:s}}}=e;this.$refs.loading.hide(),d.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,icon:"error",title:"移除失敗",text:s})})}},mounted(){this.getCarts()}},q={class:"container"},E={class:"row justify-content-center py-5"},S={class:"col"},T=t("h2",{class:"text-center fw-bold"},"購物車",-1),U={class:"fw-bold mx-1"},F={class:"table align-middle mt-4 table-hover"},I=t("thead",null,[t("tr",{class:"text-center"},[t("th",{width:"200"},"商品圖片"),t("th",{width:"250"},"商品名稱"),t("th",null,"單位"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"售價"),t("th",null,"小計"),t("th",null,"刪除")])],-1),R={class:"ratio ratio-16x9"},$=["src","alt"],z={class:"input-group input-group-sm"},G={class:"input-group"},H=["onUpdate:modelValue","onBlur"],J={class:"input-group-text",id:"basic-addon2"},K=["onClick"],O=t("i",{class:"bi bi-trash3"},null,-1),Q=[O],W=t("td",{colspan:"6",class:"text-end"},"總計",-1),X={class:"text-end"},Y={key:0},Z=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),tt={class:"text-end text-success"},et={class:"d-grid gap-2 mt-4 d-md-flex justify-content-md-between"},st=["disabled"];function ot(e,s,l,n,o,i){const f=_("RouterLink"),b=_("Loading"),x=_("ProductDeleteModal");return c(),u("div",q,[t("div",E,[t("div",S,[T,t("p",null,[h(" 總共有"),t("span",U,a(o.carts.length),1),h("件商品 ")]),t("table",F,[I,t("tbody",null,[o.carts?(c(!0),u(M,{key:0},L(o.carts,r=>(c(),u("tr",{key:r.id,class:"text-center"},[t("td",null,[t("div",R,[t("img",{src:r.product.imageUrl,class:"img-fluid object-fit-cover rounded",alt:r.product.title},null,8,$)])]),t("td",null,a(r.product.title),1),t("td",null,"1 / "+a(r.product.unit),1),t("td",null,[t("div",z,[t("div",G,[V(t("input",{"onUpdate:modelValue":p=>r.qty=p,onBlur:p=>i.updateCart(r),min:"1",type:"number",class:"form-control"},null,40,H),[[N,r.qty,void 0,{number:!0}]]),t("span",J,a(r.product.unit),1)])])]),t("td",null,a(i.getPrice(r.total)),1),t("td",null,a(i.getPrice(r.final_total)),1),t("td",null,[t("button",{type:"button",class:"btn",onClick:p=>i.openModal("delete",r)},Q,8,K)])]))),128)):g("",!0)]),t("tfoot",null,[t("tr",null,[W,t("td",X,a(i.getPrice(o.total)),1)]),o.final_total!==o.total?(c(),u("tr",Y,[Z,t("td",tt,a(i.getPrice(o.final_total)),1)])):g("",!0)])]),t("div",et,[m(f,{class:"btn btn-outline-info",to:{name:"ProductList"}},{default:C(()=>[h(" 繼續購物 ")]),_:1}),t("button",{class:"btn btn-outline-danger",disabled:i.cartsExist,onClick:s[0]||(s[0]=r=>i.openModal("deleteAll"))}," 清空購物車 ",8,st),m(f,{class:"btn btn-outline-success",to:{name:"Checkout"}},{default:C(()=>[h("送出訂單")]),_:1})])])]),m(b,{ref:"loading"},null,512),m(x,{ref:"productDeleteModal",shopCart:!0,id:o.tempProduct.cart_id,title:o.tempProduct.title,onDelete:i.removeCartItem,onDeleteAll:i.removeAllCart},null,8,["id","title","onDelete","onDeleteAll"])])}const ct=A(j,[["render",ot]]);export{ct as default};
